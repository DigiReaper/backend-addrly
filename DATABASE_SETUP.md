# Database Setup Instructions

## Supabase Setup

1. Go to your Supabase project dashboard
2. Navigate to the SQL Editor
3. Run the migration file `migrations/create_profiles_table.sql`
4. This will create:
   - `profiles` table with all onboarding fields
   - `personality_analyses` table for AI analysis storage
   - Indexes for optimized queries
   - Row Level Security policies
   - Triggers for automatic timestamp updates

## Environment Variables

### Frontend (.env.local)
```
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
NEXT_PUBLIC_API_URL=http://localhost:3001
```

### Backend (.env)
```
SUPABASE_URL=your_supabase_project_url
SUPABASE_SERVICE_KEY=your_supabase_service_role_key
PORT=3001
NODE_ENV=development
```

## Google OAuth Setup

1. Go to Google Cloud Console (https://console.cloud.google.com)
2. Create a new project or select existing
3. Enable Google+ API
4. Create OAuth 2.0 credentials
5. Add authorized redirect URIs:
   - `http://localhost:3000/auth/callback` (development)
   - `https://yourdomain.com/auth/callback` (production)
6. In Supabase Dashboard > Authentication > Providers:
   - Enable Google provider
   - Add your Google Client ID and Client Secret
   - The redirect URL will be auto-generated by Supabase

## Testing the Flow

1. Start backend: `cd backend-addrly && npm run dev`
2. Start frontend: `cd .. && npm run dev`
3. Visit http://localhost:3000
4. Click "Sign Up" or "Sign In"
5. Complete authentication (email or Google)
6. You'll be redirected to the onboarding form
7. Complete all 5 steps
8. On submission, your profile will be saved and you'll be redirected to dashboard

## API Endpoints Created

### Authentication
- POST `/api/auth/login` - Email/password login (reference only, use Supabase client)
- POST `/api/auth/logout` - Logout
- GET `/api/auth/me` - Get current user

### User Profile
- POST `/api/users/onboarding` - Complete onboarding (requires auth)
- GET `/api/users/profile` - Get user profile (requires auth)
- PUT `/api/users/profile` - Update profile (requires auth)
- GET `/api/users/matches` - Find matches (requires auth)
- POST `/api/users/analyze` - Trigger AI analysis (requires auth)
- GET `/api/users/analysis` - Get personality analyses (requires auth)

## Matching Algorithm

The matching algorithm considers:
- **Interest matching (40%)**: Common interests between users
- **Value matching (30%)**: Shared values
- **Deal breakers (-50%)**: Automatic score reduction if deal breakers are met
- **Location bonus (15%)**: Same location gets bonus points
- **Lifestyle compatibility (15%)**: Matching lifestyle preferences

Scores range from 0-100, with higher scores indicating better matches.
